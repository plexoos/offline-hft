From cda8397435c5b033d6f5555bf86d75b9d4ea0d6d Mon Sep 17 00:00:00 2001
From: Dmitri Smirnov <d.s@plexoos.com>
Date: Mon, 21 Apr 2014 18:46:57 -0400
Subject: [PATCH 1/3] Process StiMaker attributes to create test volumes

---
 StiMaker/StiMaker.cxx | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

diff --git a/StiMaker/StiMaker.cxx b/StiMaker/StiMaker.cxx
index 30af478..9e0a0d5 100644
--- a/StiMaker/StiMaker.cxx
+++ b/StiMaker/StiMaker.cxx
@@ -451,6 +451,8 @@ More detailed: 				<br>
 
 #include "StiTpc/StiTpcDetectorBuilder.h"
 #include "StiSvt/StiSvtDetectorBuilder.h"
+#include "StiTest/StiTestDetectorBuilder.h"
+#include "StiTest/StiTestDetectorGroup.h"
 #include "StDetectorDbMaker/StiHitErrorCalculator.h"
 // #include "StiRnD/Ist/StiIstDetectorGroup.h"
 // #include "StiRnD/Ist/StiIstDetectorGroup.h"
@@ -651,6 +653,23 @@ Int_t StiMaker::InitDetectors()
       _toolkit->add(group = new StiIstDetectorGroup(IAttr("activeIst"),SAttr("istInputFile")));
       group->setGroupId(kIstId);  
     }
+   if (IAttr("useTestGeom"))
+   {
+      cout << "StiMaker::Init() -I- Adding detector group: Test" << endl;
+
+      StiTestDetectorBuilder::ETestGeomType geomType = StiTestDetectorBuilder::kDefault;
+
+      if      (IAttr("StiTestSimpleBox"))        geomType = StiTestDetectorBuilder::kSimpleBox;
+      else if (IAttr("StiTestSimpleBox2"))       geomType = StiTestDetectorBuilder::kSimpleBox2;
+      else if (IAttr("StiTestSimpleBox8"))       geomType = StiTestDetectorBuilder::kSimpleBox8;
+      else if (IAttr("StiTestSimplePlane"))      geomType = StiTestDetectorBuilder::kSimplePlane;
+      else if (IAttr("StiTestSimpleTube"))       geomType = StiTestDetectorBuilder::kSimpleTube;
+      else if (IAttr("StiTestSimpleTubeSector")) geomType = StiTestDetectorBuilder::kSimpleTubeSector;
+      else if (IAttr("StiTestEnclosedTubes"))    geomType = StiTestDetectorBuilder::kEnclosedTubes;
+
+      _toolkit->add(group = new StiTestDetectorGroup(geomType));
+      group->setGroupId(kTestGeomId);
+   }
 //  if (IAttr("useBTof"))
 //     { 
 //       cout<<"StiMaker::Init() -I- Adding detector group:BTof"<<endl;  
-- 
1.8.2.GIT


From 61ac04d5ff67d1bba7cd0d9e17914e66f476a041 Mon Sep 17 00:00:00 2001
From: Dmitri Smirnov <d.s@plexoos.com>
Date: Wed, 23 Apr 2014 16:12:43 -0400
Subject: [PATCH 2/3] Added new options for Sti test to check overlapping and
 non-overlapping tubes

---
 StiMaker/StiMaker.cxx | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/StiMaker/StiMaker.cxx b/StiMaker/StiMaker.cxx
index 9e0a0d5..b91e170 100644
--- a/StiMaker/StiMaker.cxx
+++ b/StiMaker/StiMaker.cxx
@@ -666,6 +666,8 @@ Int_t StiMaker::InitDetectors()
       else if (IAttr("StiTestSimpleTube"))       geomType = StiTestDetectorBuilder::kSimpleTube;
       else if (IAttr("StiTestSimpleTubeSector")) geomType = StiTestDetectorBuilder::kSimpleTubeSector;
       else if (IAttr("StiTestEnclosedTubes"))    geomType = StiTestDetectorBuilder::kEnclosedTubes;
+      else if (IAttr("StiTestOverlapTubes"))     geomType = StiTestDetectorBuilder::kOverlapTubes;
+      else if (IAttr("StiTestNoOverlapTubes"))   geomType = StiTestDetectorBuilder::kNoOverlapTubes;
 
       _toolkit->add(group = new StiTestDetectorGroup(geomType));
       group->setGroupId(kTestGeomId);
-- 
1.8.2.GIT


From 809226da17674717409ee32eede4dd3845d78fb1 Mon Sep 17 00:00:00 2001
From: Dmitri Smirnov <d.s@plexoos.com>
Date: Mon, 28 Apr 2014 19:26:35 -0400
Subject: [PATCH 3/3] In StiMaker construct the PXL detector using the option
 for ideal/survey geometry transformations. The default is to use a non-ideal
 survey geometry

---
 StiMaker/StiMaker.cxx | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/StiMaker/StiMaker.cxx b/StiMaker/StiMaker.cxx
index b91e170..b0487fa 100644
--- a/StiMaker/StiMaker.cxx
+++ b/StiMaker/StiMaker.cxx
@@ -520,6 +520,8 @@ StiMaker::StiMaker(const Char_t *name) :
   SetAttr("useTracker"          ,kTRUE);
   SetAttr("useVertexFinder"     ,kTRUE);
   SetAttr("Alignment"           ,kFALSE);
+  SetAttr("buildIdealStiGeom"   ,kFALSE);
+
   if (strstr(gSystem->Getenv("STAR"),".DEV"))
      SetAttr("useAux",kTRUE); // Auxiliary info added to output for evaluation
 }
@@ -644,7 +646,7 @@ Int_t StiMaker::InitDetectors()
   if (IAttr("usePixel"))
     {
       cout<<"StiMaker::Init() -I- Adding detector group:PIXEL"<<endl;
-      _toolkit->add(group = new StiPxlDetectorGroup(IAttr("activePixel"),SAttr("pixelInputFile")));
+      _toolkit->add(group = new StiPxlDetectorGroup(IAttr("activePixel"), SAttr("pixelInputFile"), IAttr("buildIdealStiGeom")));
       group->setGroupId(kPxlId);
     }
  if (IAttr("useIst"))
-- 
1.8.2.GIT

